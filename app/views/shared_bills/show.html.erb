<%= render(HeaderComponent.new(
  title: @shared_bill.name
)) do |c| %>
  <%= c.with_crumb("Home", home_path) %>
  <%= c.with_crumb("Shared Bills", shared_bills_path) %>

  <%= c.with_action do %>
    <%= link_to(
      "Edit",
      edit_shared_bill_path(@shared_bill),
      class: "button"
    ) %>
  <% end %>

  <%= c.with_action do %>
    <%= button_to(
      "Delete",
      shared_bill_path(@shared_bill),
      method: "delete",
      data: {turbo_confirm: "Are you sure?"},
      class: "button button--danger"
    ) %>
  <% end %>
<% end %>

<div class="bg-white rounded-lg border border-gray-200 p-6">
  <div class="flex justify-between items-center mb-4">
    <h3 class="text-lg font-semibold">Payees</h3>
    <%= link_to(
      "New Payee",
      new_shared_bill_payee_path(@shared_bill),
      class: "button"
    ) %>
  </div>

  <% if @payees.any? %>
    <div class="space-y-2">
      <% @payees.each do |payee| %>
        <div class="flex flex-col items-center justify-between p-3 bg-gray-50 rounded-lg sm:flex-row"
             data-role="payee">
          <span class="font-medium mb-5 sm:mb-0"><%= payee.name %></span>
          <div class="flex flex-col gap-2 sm:flex-row">
            <%= link_to(
              "Edit",
              edit_shared_bill_payee_path(@shared_bill, payee),
              class: "button text-center button--secondary button--small"
            ) %>
            <%= button_to(
              "Remove",
              shared_bill_payee_path(@shared_bill, payee),
              method: :delete,
              data: {turbo_confirm: "Remove #{payee.name}?"},
              class: "button button--danger button--small"
            ) %>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <p class="text-gray-500 italic">No payees yet.</p>
  <% end %>
</div>

<div class="mt-6 bg-white rounded-lg border border-gray-200 p-6">
  <div class="flex justify-between items-center mb-4">
    <h3 class="text-lg font-semibold">Bills</h3>
    <%= link_to(
      "New Bill",
      new_shared_bill_bill_path(@shared_bill),
      class: "button"
    ) %>
  </div>

  <% if @bills.any? %>
    <div class="space-y-4">
      <% @bills.each do |bill| %>
        <div class="flex flex-col items-start justify-between p-3 bg-gray-50 rounded-lg" data-role="bill">
          <div class="flex flex-col justify-between w-full mb-4 sm:flex-row">
            <div class="font-medium">
              <%= bill.period_start.to_date %> - <%= bill.period_end.to_date %>
            </div>
            <div class="flex flex-row gap-2 mt-4 justify-center sm:mt-0">
              <%= link_to(
                "Edit",
                edit_shared_bill_bill_path(@shared_bill, bill),
                class: "button button--secondary button--small"
              ) %>
              <%= button_to(
                "Remove",
                shared_bill_bill_path(@shared_bill, bill),
                method: :delete,
                data: {
                  turbo_confirm: "Remove bill for #{bill.period_start.to_date} - #{bill.period_end.to_date}?"
                },
                class: "button button--danger button--small"
              ) %>
            </div>
          </div>
          <div class="flex items-center gap-3">
            <span class="text-gray-600">
              $<%= sprintf("%.2f", bill.total_amount / 100.0) %>
            </span>
            <% if bill.all_payees_paid %>
              <%= render(PillComponent.new(text: "Paid", color: :green)) %>
            <% else %>
              <%= render(PillComponent.new(text: "Unpaid", color: :red)) %>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <p class="text-gray-500 italic">No bills yet.</p>
  <% end %>
</div>


