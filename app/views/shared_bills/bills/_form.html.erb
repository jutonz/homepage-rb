<%= simple_form_for(
  @bill_form,
  as: :bill_form,
  url: (
    @bill_form.persisted? ?
    shared_bill_bill_path(@shared_bill, @bill_form.bill) :
    shared_bill_bills_path(@shared_bill)
  )
) do |form| %>
  <%= form.error_notification %>
  <% if form.object.errors[:base].present? %>
    <%= form.error_notification(
      message: form.object.errors[:base].to_sentence
    ) %>
  <% end %>

  <%= form.input(:period_start, as: :datetime, autofocus: true) %>
  <%= form.input(:period_end, as: :datetime) %>

  <% if @shared_bill.payees.any? %>
    <div class="mb-4">
      <label class="block text-sm font-medium text-gray-700 mb-2">
        Payees
      </label>
      <div class="space-y-2">
        <% @shared_bill.payees.order(:name).each do |payee| %>
          <div class="flex items-center gap-4 p-3 bg-gray-50
                      rounded-lg border border-gray-200">
            <%= check_box_tag(
              "bill_form[payee_amounts][#{payee.id}][selected]",
              "1",
              @bill_form.payee_amounts[payee.id.to_s]&.dig(:selected),
              id: "bill_form_payee_amounts_#{payee.id}_selected",
              class: "h-4 w-4 text-blue-600 border-gray-300
                      rounded focus:ring-blue-500"
            ) %>
            <label for="bill_form_payee_amounts_<%= payee.id %>_selected"
                   class="flex-1 text-sm font-medium text-gray-700">
              <%= payee.name %>
            </label>
            <%= number_field_tag(
              "bill_form[payee_amounts][#{payee.id}][amount]",
              @bill_form.payee_amounts[payee.id.to_s]&.dig(:amount),
              placeholder: "Amount (cents)",
              class: "w-40 rounded-md border-gray-300 shadow-sm
                      focus:border-blue-500 focus:ring-blue-500 sm:text-sm"
            ) %>
            <% if @bill_form.persisted? %>
              <div class="flex items-center">
                <%= check_box_tag(
                  "bill_form[payee_amounts][#{payee.id}][paid]",
                  "1",
                  @bill_form.payee_amounts[payee.id.to_s]&.dig(:paid),
                  id: "bill_form_payee_amounts_#{payee.id}_paid",
                  class: "h-4 w-4 text-green-600 border-gray-300
                          rounded focus:ring-green-500"
                ) %>
                <label for="bill_form_payee_amounts_<%= payee.id %>_paid"
                       class="ml-2 text-sm text-gray-700">
                  Paid?
                </label>
              </div>
            <% end %>
          </div>
        <% end %>
      </div>
    </div>
  <% else %>
    <p class="text-gray-500 italic mb-4">
      No payees yet. Please add payees first.
    </p>
  <% end %>

  <%= form.button(:submit) %>
<% end %>
